<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - Joki LifeAfter Pro</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Montserrat', sans-serif;
      background-color: #1a1a2e; /* Darker background */
      color: #e0e0e0; /* Lighter text */
    }
    h1, h2, h3, h4 {
      font-family: 'Orbitron', sans-serif; /* Sci-fi/gaming font for headings */
    }
    .btn-primary {
      background-image: linear-gradient(to right, #e94560, #ff6b6b);
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(233, 69, 96, 0.4);
    }
    .btn-primary:hover {
      background-image: linear-gradient(to right, #ff6b6b, #e94560);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(233, 69, 96, 0.6);
    }
    .btn-secondary {
      background-color: #3f72af;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(63, 114, 175, 0.4);
    }
    .btn-secondary:hover {
      background-color: #528ecc;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(63, 114, 175, 0.6);
    }
    .btn-danger {
      background-color: #dc3545;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(220, 53, 69, 0.4);
    }
    .btn-danger:hover {
      background-color: #c82333;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(220, 53, 69, 0.6);
    }
    .card {
      background-color: #2e2e4a; /* Slightly lighter card background */
      border: 1px solid #4a4a6a;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .card:hover {
      transform: translateY(-2px); /* Slight hover for cards */
      box-shadow: 0 10px 28px rgba(0, 0, 0, 0.4);
    }
    input[type="text"], input[type="password"], input[type="email"], select, textarea {
      background-color: #1f1f3a;
      border: 1px solid #4a4a6a;
      color: #e0e0e0;
    }
    input[type="text"]:focus, input[type="password"]:focus, input[type="email"]:focus, select:focus, textarea:focus {
      border-color: #e94560;
      box-shadow: 0 0 0 2px rgba(233, 69, 96, 0.5);
    }
    .status-pending { color: #ffc107; } /* Yellow */
    .status-in-progress { color: #00bcd4; } /* Cyan */
    .status-completed { color: #4CAF50; } /* Green */
    .status-cancelled { color: #dc3545; } /* Red */

    /* Progress Tracker Styles */
    .progress-tracker {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 1rem;
      position: relative;
      padding: 0 10px; /* Add padding to ensure circles are not cut off */
    }
    .progress-tracker::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      height: 2px;
      background-color: #4a4a6a; /* Line color */
      transform: translateY(-50%);
      z-index: 0;
    }
    .progress-step {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      z-index: 1;
      text-align: center;
      flex: 1; /* Distribute space evenly */
    }
    .progress-circle {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background-color: #4a4a6a; /* Default circle color */
      display: flex;
      justify-content: center;
      align-items: center;
      color: #e0e0e0;
      font-size: 0.75rem;
      font-weight: bold;
      border: 2px solid #4a4a6a;
      transition: background-color 0.3s ease, border-color 0.3s ease;
    }
    .progress-label {
      font-size: 0.75rem;
      margin-top: 0.5rem;
      color: #9ca3af; /* Default label color */
      transition: color 0.3s ease;
    }

    /* Active/Completed/Cancelled states for progress tracker */
    .progress-step.active .progress-circle {
      background-color: #00bcd4; /* In Progress */
      border-color: #00bcd4;
    }
    .progress-step.active .progress-label {
      color: #00bcd4;
    }
    .progress-step.completed .progress-circle {
      background-color: #4CAF50; /* Completed */
      border-color: #4CAF50;
    }
    .progress-step.completed .progress-label {
      color: #4CAF50;
    }
    .progress-step.cancelled .progress-circle {
      background-color: #dc3545; /* Cancelled */
      border-color: #dc3545;
    }
    .progress-step.cancelled .progress-label {
      color: #dc3545;
    }
    .progress-step.pending .progress-circle {
      background-color: #ffc107; /* Pending */
      border-color: #ffc107;
    }
    .progress-step.pending .progress-label {
      color: #ffc107;
    }
  </style>
  <script type="text/javascript" src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script type="text/javascript" src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script type="text/javascript" src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
  <script type="text/javascript" src="https://www.gstatic.com/firebasejs/9.6.10/firebase-storage-compat.js"></script>
  <script type="module">
    // --- Firebase Setup ---
    const firebaseConfig = {
      apiKey: "AIzaSyBdKELW2FNsL7H1zB8R765czcDPaSYybdg",
      authDomain: "atlantis-store.firebaseapp.com",
      databaseURL: "https://atlantis-store-default-rtdb.firebaseio.com",
      projectId: "atlantis-store",
      storageBucket: "atlantis-store.appspot.com",
      messagingSenderId: "566295949160",
      appId: "1:566295949160:web:3ad8956c753d2f05a5f0dd",
      measurementId: "G-F5RG09TFCK"
    };

    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const auth = firebase.auth();
    const db = firebase.database();
    const storage = firebase.storage();

    // --- Admin Email Whitelist (Specific Emails) ---
    const ADMIN_EMAILS = ['admin@atlantis.com', 'itsupport@atlantis.com', 'service@atlantis.com'];

    // --- UI Elements ---
    const loginSection = document.getElementById("loginSection");
    const dashboardSection = document.getElementById("dashboardSection");
    const adminEmailDisplay = document.getElementById("adminEmailDisplay");
    const ordersList = document.getElementById("ordersList");
    const loginForm = document.getElementById("loginForm");
    const bannerManagementSection = document.getElementById("bannerManagementSection");
    const bannerForm = document.getElementById("bannerForm");
    const bannerList = document.getElementById("bannerList");
    const bannerImagePreview = document.getElementById("bannerImagePreview");
    const bannerSubmitButton = document.getElementById("bannerSubmitButton");
    const bannerCancelEditButton = document.getElementById("bannerCancelEditButton");
    const orderStatusFilter = document.getElementById("orderStatusFilter"); // New filter element

    let editingBannerId = null; // To store the ID of the banner being edited
    let currentFilterStatus = 'all'; // Default filter status for orders

    // --- Auth State Listener ---
    auth.onAuthStateChanged(async (user) => {
      if (user) {
        // Check if the logged-in user's email is in the ADMIN_EMAILS whitelist
        if (ADMIN_EMAILS.includes(user.email)) {
          // If email is whitelisted, grant access to dashboard
          loginSection.classList.add("hidden");
          dashboardSection.classList.remove("hidden");
          adminEmailDisplay.textContent = user.email;
          fetchOrders(currentFilterStatus); // Fetch orders with current filter
          fetchBanners(); // Fetch banners when admin logs in
        } else {
          // If email is not whitelisted, deny access and log out
          alert("Akses ditolak. Email Anda tidak terdaftar sebagai admin yang diizinkan.");
          await auth.signOut();
        }
      } else {
        // User is logged out
        loginSection.classList.remove("hidden");
        dashboardSection.classList.add("hidden");
        adminEmailDisplay.textContent = "";
        ordersList.innerHTML = "";
        bannerList.innerHTML = ""; // Clear banners on logout
      }
    });

    // --- Handle Admin Login ---
    async function handleLogin(e) {
      e.preventDefault();
      const email = loginForm.adminEmail.value;
      const password = loginForm.adminPassword.value;

      if (!email || !password) {
        alert("Email dan password harus diisi.");
        return;
      }

      // Check if the entered email is in the ADMIN_EMAILS whitelist
      if (!ADMIN_EMAILS.includes(email)) {
        alert("Akses ditolak. Email Anda tidak terdaftar sebagai admin yang diizinkan.");
        return;
      }

      try {
        await auth.signInWithEmailAndPassword(email, password);
        // auth.onAuthStateChanged will handle the rest of the access check
      } catch (error) {
        console.error("Login gagal:", error);
        alert("Login gagal: " + error.message);
      }
    }

    // --- Handle Admin Logout ---
    async function handleLogout() {
      try {
        await auth.signOut();
        alert("Anda telah logout dari dashboard admin.");
      } catch (error) {
        console.error("Logout gagal:", error);
        alert("Logout gagal: " + error.message);
      }
    }

    // --- Fetch All Orders ---
    function fetchOrders(filterStatus = 'all') {
      ordersList.innerHTML = '<p class="text-gray-400 text-center py-4"><i class="fas fa-spinner fa-spin mr-2"></i>Memuat pesanan...</p>';
      let ordersRef = db.ref('orders');

      if (filterStatus !== 'all') {
        ordersRef = ordersRef.orderByChild('status').equalTo(filterStatus);
      }

      ordersRef.on('value', (snapshot) => {
        if (snapshot.exists()) {
          ordersList.innerHTML = '';
          const orders = [];
          snapshot.forEach((childSnapshot) => {
            orders.push({ id: childSnapshot.key, ...childSnapshot.val() });
          });

          // Sort orders by timestamp, newest first
          orders.sort((a, b) => b.waktu - a.waktu);

          orders.forEach((order) => {
            const orderElement = document.createElement('div');
            orderElement.className = 'card p-6 rounded-xl mb-4';
            let statusClass = '';
            switch (order.status) {
              case 'pending': statusClass = 'status-pending'; break;
              case 'in progress': statusClass = 'status-in-progress'; break;
              case 'completed': statusClass = 'status-completed'; break;
              case 'cancelled': statusClass = 'status-cancelled'; break;
              default: statusClass = 'text-gray-400';
            }

            // Determine progress tracker classes
            let pendingClass = '';
            let inProgressClass = '';
            let completedClass = '';
            let cancelledClass = '';

            if (order.status === 'pending') {
                pendingClass = 'pending';
            } else if (order.status === 'in progress') {
                pendingClass = 'completed'; // Considered completed for previous step
                inProgressClass = 'active';
            } else if (order.status === 'completed') {
                pendingClass = 'completed';
                inProgressClass = 'completed';
                completedClass = 'completed';
            } else if (order.status === 'cancelled') {
                pendingClass = 'completed'; // Show previous steps as completed before cancellation
                inProgressClass = 'completed';
                cancelledClass = 'cancelled';
            }


            orderElement.innerHTML = `
              <div class="flex justify-between items-center mb-4 border-b border-gray-600 pb-3">
                <h5 class="text-xl font-bold text-red-400">Order ID: <span class="text-gray-300 text-base">${order.id}</span></h5>
                <span class="text-sm font-semibold ${statusClass}">${order.status ? order.status.toUpperCase() : 'N/A'}</span>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-y-2 gap-x-4 text-gray-300 mb-4">
                <p><i class="fas fa-user mr-2 text-blue-400"></i>Nama Pemesan: <span class="font-medium">${order.nama || 'N/A'}</span></p>
                <p><i class="fas fa-envelope mr-2 text-blue-400"></i>Email: <span class="font-medium">${order.email || 'N/A'}</span></p>
                <p><i class="fas fa-gamepad mr-2 text-blue-400"></i>Jenis Joki: <span class="font-medium">${order.jenis === 'full' ? 'Death High Full Service' : 'Death High Per Floor'}</span></p>
                <p><i class="fas fa-mobile-alt mr-2 text-blue-400"></i>Device: <span class="font-medium">${order.device || 'N/A'}</span></p>
                <p><i class="fas fa-key mr-2 text-yellow-400"></i>Transfer Code: <span class="font-medium">${order.transferCode || 'N/A'}</span></p>
                <p><i class="fas fa-lock mr-2 text-yellow-400"></i>Password: <span class="font-medium">${order.password || 'N/A'}</span></p>
                <p><i class="fab fa-whatsapp mr-2 text-green-400"></i>WhatsApp: <a href="https://wa.me/${order.whatsapp}" target="_blank" class="text-green-400 hover:underline">${order.whatsapp || 'N/A'}</a></p>
                <p class="text-sm text-gray-500"><i class="fas fa-clock mr-2 text-gray-500"></i>Waktu Order: ${order.waktu ? new Date(order.waktu).toLocaleString() : 'N/A'}</p>
              </div>
              ${order.proofURL ? `<a href="${order.proofURL}" target="_blank" class="btn-secondary inline-block text-white px-4 py-2 rounded-lg text-sm mt-2 mr-2"><i class="fas fa-image mr-1"></i>Lihat Bukti Pembayaran</a>` : ''}
              
              <!-- Progress Tracker -->
              <div class="progress-tracker">
                <div class="progress-step ${pendingClass}">
                  <div class="progress-circle"><i class="fas fa-hourglass-half"></i></div>
                  <div class="progress-label">Pending</div>
                </div>
                <div class="progress-step ${inProgressClass}">
                  <div class="progress-circle"><i class="fas fa-cogs"></i></div>
                  <div class="progress-label">In Progress</div>
                </div>
                <div class="progress-step ${completedClass}">
                  <div class="progress-circle"><i class="fas fa-check"></i></div>
                  <div class="progress-label">Completed</div>
                </div>
                <div class="progress-step ${cancelledClass}">
                  <div class="progress-circle"><i class="fas fa-times"></i></div>
                  <div class="progress-label">Cancelled</div>
                </div>
              </div>

              <div class="mt-4 flex items-center space-x-3">
                <label for="status-${order.id}" class="text-gray-300">Ubah Status:</label>
                <select id="status-${order.id}" class="p-2 rounded-lg bg-gray-700 border border-gray-600 focus:border-red-500 focus:outline-none" onchange="updateOrderStatus('${order.id}', this.value)">
                  <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>Pending</option>
                  <option value="in progress" ${order.status === 'in progress' ? 'selected' : ''}>In Progress</option>
                  <option value="completed" ${order.status === 'completed' ? 'selected' : ''}>Completed</option>
                  <option value="cancelled" ${order.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
                </select>
              </div>
            `;
            ordersList.appendChild(orderElement);
          });
        } else {
          ordersList.innerHTML = '<p class="text-gray-400 text-center py-4">Belum ada pesanan joki dengan status ini.</p>';
        }
      }, (error) => {
        console.error("Error fetching orders:", error);
        ordersList.innerHTML = '<p class="text-red-500 text-center py-4">Gagal memuat pesanan. Silakan coba lagi.</p>';
      });
    }

    // Event listener for filter change
    if (orderStatusFilter) {
        orderStatusFilter.addEventListener('change', (e) => {
            currentFilterStatus = e.target.value;
            fetchOrders(currentFilterStatus);
        });
    }

    // --- Update Order Status ---
    async function updateOrderStatus(orderId, newStatus) {
      try {
        await db.ref('orders/' + orderId).update({ status: newStatus });
        alert(`Status pesanan ${orderId} berhasil diubah menjadi ${newStatus.toUpperCase()}.`);
      } catch (error) {
        console.error("Gagal update status:", error);
        alert("Gagal mengubah status pesanan: " + error.message);
      }
    }

    // --- Banner Management Functions ---

    // Preview banner image on select
    function previewBannerImage(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          bannerImagePreview.innerHTML = `<img src="${e.target.result}" alt="Preview Banner" class="max-w-full h-48 object-contain rounded-lg mt-2 border border-gray-600 shadow-md">`;
        };
        reader.readAsDataURL(file);
      } else {
        bannerImagePreview.innerHTML = "";
      }
    }

    // Handle banner upload/submission (create or update)
    async function handleBannerSubmit(e) {
      e.preventDefault();
      const title = bannerForm.bannerTitle.value;
      const description = bannerForm.bannerDescription.value;
      const link = bannerForm.bannerLink.value;
      const imageFile = bannerForm.bannerImage.files[0]; // This will be null if no new file is selected during edit

      if (!title) {
        alert("Judul banner wajib diisi.");
        return;
      }

      // If creating a new banner, image file is required
      if (!editingBannerId && !imageFile) {
        alert("Gambar banner wajib diunggah untuk banner baru.");
        return;
      }

      bannerSubmitButton.disabled = true;
      bannerSubmitButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Memproses...';

      try {
        let downloadURL = bannerImagePreview.querySelector('img') ? bannerImagePreview.querySelector('img').src : null; // Current image URL if editing and no new file

        // If a new image file is selected, upload it
        if (imageFile) {
          const storageRef = storage.ref().child(`banners/${Date.now()}_${imageFile.name}`);
          const uploadTask = storageRef.put(imageFile);

          await new Promise((resolve, reject) => {
            uploadTask.on('state_changed',
              (snapshot) => {
                const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                console.log('Upload is ' + progress + '% done');
              },
              (error) => {
                console.error('Upload error:', error);
                reject(new Error("Gagal mengunggah gambar banner."));
              },
              async () => {
                resolve();
              }
            );
          });
          downloadURL = await uploadTask.snapshot.ref.getDownloadURL();

          // If editing and a new image is uploaded, delete the old one if it exists
          if (editingBannerId) {
            const oldBanner = await db.ref('banners/' + editingBannerId).once('value');
            const oldImageUrl = oldBanner.val().imageUrl;
            if (oldImageUrl && oldImageUrl !== downloadURL) {
              try {
                const oldImageRef = storage.refFromURL(oldImageUrl);
                await oldImageRef.delete();
                console.log("Old banner image deleted successfully.");
              } catch (deleteError) {
                console.warn("Could not delete old banner image (might not exist or permission issue):", deleteError);
              }
            }
          }
        } else if (!editingBannerId && !downloadURL) {
            // This case should be caught by the initial !imageFile check for new banners
            alert("Gambar banner wajib diunggah untuk banner baru.");
            return;
        }


        const bannerData = {
          title,
          description: description || '',
          link: link || '',
          imageUrl: downloadURL,
          timestamp: firebase.database.ServerValue.TIMESTAMP // Update timestamp on any change
        };

        if (editingBannerId) {
          await db.ref('banners/' + editingBannerId).update(bannerData);
          alert("Banner berhasil diperbarui!");
        } else {
          await db.ref('banners').push(bannerData);
          alert("Banner berhasil diunggah!");
        }

        bannerForm.reset();
        bannerImagePreview.innerHTML = "";
        editingBannerId = null; // Reset editing state
        bannerSubmitButton.innerHTML = '<i class="fas fa-upload mr-2"></i>Unggah Banner';
        bannerCancelEditButton.classList.add('hidden');
        fetchBanners(); // Refresh banner list
      } catch (error) {
        console.error('Gagal memproses banner:', error);
        alert("Gagal memproses banner: " + error.message);
      } finally {
        bannerSubmitButton.disabled = false;
      }
    }

    // Fetch and display all banners
    function fetchBanners() {
      bannerList.innerHTML = '<p class="text-gray-400 text-center py-4"><i class="fas fa-spinner fa-spin mr-2"></i>Memuat banner...</p>';
      db.ref('banners').on('value', (snapshot) => {
        if (snapshot.exists()) {
          bannerList.innerHTML = '';
          const banners = [];
          snapshot.forEach((childSnapshot) => {
            banners.push({ id: childSnapshot.key, ...childSnapshot.val() });
          });

          banners.sort((a, b) => b.timestamp - a.timestamp); // Newest first

          banners.forEach((banner) => {
            const bannerElement = document.createElement('div');
            bannerElement.className = 'card p-4 rounded-xl flex flex-col md:flex-row items-center mb-4 space-y-4 md:space-y-0 md:space-x-4';
            bannerElement.innerHTML = `
              <img src="${banner.imageUrl}" alt="${banner.title}" class="w-full md:w-48 h-32 object-cover rounded-lg border border-gray-700">
              <div class="flex-grow text-center md:text-left">
                <h5 class="text-lg font-bold text-white">${banner.title}</h5>
                <p class="text-sm text-gray-400">${banner.description}</p>
                ${banner.link ? `<a href="${banner.link}" target="_blank" class="text-blue-400 hover:underline text-sm block mt-1"><i class="fas fa-external-link-alt mr-1"></i>Link</a>` : ''}
                <p class="text-xs text-gray-500 mt-1">Diunggah: ${new Date(banner.timestamp).toLocaleString()}</p>
              </div>
              <div class="flex space-x-2 mt-4 md:mt-0">
                <button onclick="editBanner('${banner.id}')" class="btn-secondary px-3 py-1 rounded-lg text-sm"><i class="fas fa-edit mr-1"></i>Edit</button>
                <button onclick="deleteBanner('${banner.id}', '${banner.imageUrl}')" class="btn-danger px-3 py-1 rounded-lg text-sm"><i class="fas fa-trash-alt mr-1"></i>Hapus</button>
              </div>
            `;
            bannerList.appendChild(bannerElement);
          });
        } else {
          bannerList.innerHTML = '<p class="text-gray-400 text-center py-4">Belum ada banner yang diunggah.</p>';
        }
      }, (error) => {
        console.error("Error fetching banners:", error);
        bannerList.innerHTML = '<p class="text-red-500 text-center py-4">Gagal memuat banner. Silakan coba lagi.</p>';
      });
    }

    // Function to edit banner
    async function editBanner(bannerId) {
      try {
        const snapshot = await db.ref('banners/' + bannerId).once('value');
        const banner = snapshot.val();

        if (banner) {
          editingBannerId = bannerId;
          bannerForm.bannerTitle.value = banner.title;
          bannerForm.bannerDescription.value = banner.description;
          bannerForm.bannerLink.value = banner.link;
          bannerImagePreview.innerHTML = `<img src="${banner.imageUrl}" alt="Preview Banner" class="max-w-full h-48 object-contain rounded-lg mt-2 border border-gray-600 shadow-md">`;
          bannerSubmitButton.innerHTML = '<i class="fas fa-save mr-2"></i>Update Banner';
          bannerCancelEditButton.classList.remove('hidden');
          window.scrollTo({ top: bannerManagementSection.offsetTop, behavior: 'smooth' }); // Scroll to form
        }
      } catch (error) {
        console.error("Error fetching banner for edit:", error);
        alert("Gagal memuat data banner untuk diedit.");
      }
    }

    // Function to cancel edit mode
    function cancelEdit() {
      editingBannerId = null;
      bannerForm.reset();
      bannerImagePreview.innerHTML = "";
      bannerSubmitButton.innerHTML = '<i class="fas fa-upload mr-2"></i>Unggah Banner';
      bannerCancelEditButton.classList.add('hidden');
    }

    // Function to delete banner
    async function deleteBanner(bannerId, imageUrl) {
      if (!confirm("Apakah Anda yakin ingin menghapus banner ini?")) {
        return;
      }

      try {
        // Delete image from Firebase Storage
        if (imageUrl) {
          const imageRef = storage.refFromURL(imageUrl);
          await imageRef.delete();
        }

        // Delete data from Realtime Database
        await db.ref('banners/' + bannerId).remove();

        alert("Banner berhasil dihapus!");
        // No need to call fetchBanners() explicitly, as on('value') listener will handle it
      } catch (error) {
        console.error("Gagal menghapus banner:", error);
        alert("Gagal menghapus banner: " + error.message);
      }
    }

    // Expose functions to global scope
    window.handleLogin = handleLogin;
    window.handleLogout = handleLogout;
    window.updateOrderStatus = updateOrderStatus;
    window.previewBannerImage = previewBannerImage;
    window.handleBannerSubmit = handleBannerSubmit;
    window.editBanner = editBanner;
    window.deleteBanner = deleteBanner;
    window.cancelEdit = cancelEdit; // Expose cancelEdit
  </script>
</head>
<body class="flex flex-col min-h-screen">
  <!-- Header -->
  <header class="bg-gradient-to-r from-[#1a1a2e] to-[#0f0f1a] p-4 md:p-6 text-center shadow-2xl border-b-2 border-[#e94560]">
    <div class="flex justify-center items-center space-x-3 mb-2">
      <i class="fas fa-user-shield text-4xl text-[#e94560]"></i>
      <h1 class="text-3xl md:text-5xl font-bold text-white tracking-wide">Admin <span class="text-[#e94560]">Dashboard</span></h1>
    </div>
    <p class="text-sm md:text-base text-gray-400">Joki LifeAfter Pro - Mizuki Hiroshi Ch.</p>
  </header>

  <!-- Main Content -->
  <main class="flex-grow container mx-auto p-6 md:p-8">

    <!-- Login Section -->
    <section id="loginSection" class="max-w-md mx-auto mt-10">
      <h2 class="text-2xl md:text-4xl font-bold mb-8 text-center text-[#e94560] flex items-center justify-center space-x-3">
        <i class="fas fa-lock"></i>
        <span>Login Admin</span>
      </h2>
      <div class="card p-8 rounded-xl">
        <form id="loginForm" onsubmit="handleLogin(event)" class="space-y-5">
          <div>
            <label for="adminEmail" class="block text-sm font-medium mb-2 text-gray-300">Email Admin</label>
            <input type="email" id="adminEmail" class="w-full p-3 rounded-lg focus:outline-none" required placeholder="admin@atlantis.com">
          </div>
          <div>
            <label for="adminPassword" class="block text-sm font-medium mb-2 text-gray-300">Password</label>
            <input type="password" id="adminPassword" class="w-full p-3 rounded-lg focus:outline-none" required placeholder="Masukkan password admin">
          </div>
          <button type="submit" class="btn-primary w-full text-white px-6 py-3 rounded-lg font-bold text-lg">
            <i class="fas fa-sign-in-alt mr-2"></i>Login
          </button>
        </form>
      </div>
    </section>

    <!-- Admin Dashboard Section (Hidden until logged in) -->
    <section id="dashboardSection" class="hidden max-w-6xl mx-auto mt-10">
      <div class="card p-8 rounded-xl mb-8">
        <div class="flex flex-col md:flex-row justify-between items-center mb-6 pb-4 border-b border-gray-600">
          <h2 class="text-2xl md:text-3xl font-bold text-[#e94560] flex items-center space-x-3 mb-4 md:mb-0">
            <i class="fas fa-clipboard-list"></i>
            <span>Daftar Pesanan Joki</span>
          </h2>
          <div class="flex items-center space-x-4">
            <span class="text-gray-300 text-lg">Halo, <span id="adminEmailDisplay" class="font-semibold text-red-300"></span>!</span>
            <button id="logoutBtn" onclick="handleLogout()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg text-sm transition-colors duration-300">
              <i class="fas fa-sign-out-alt mr-1"></i>Logout
            </button>
          </div>
        </div>

        <!-- Order Status Filter -->
        <div class="mb-6 flex items-center space-x-3">
            <label for="orderStatusFilter" class="text-gray-300 font-medium">Filter Status:</label>
            <select id="orderStatusFilter" class="p-2 rounded-lg bg-gray-700 border border-gray-600 focus:border-red-500 focus:outline-none">
                <option value="all">Semua Status</option>
                <option value="pending">Pending</option>
                <option value="in progress">In Progress</option>
                <option value="completed">Completed</option>
                <option value="cancelled">Cancelled</option>
            </select>
        </div>

        <div id="ordersList" class="space-y-6">
          <!-- Orders will be loaded here -->
          <p class="text-gray-400 text-center py-4"><i class="fas fa-spinner fa-spin mr-2"></i>Memuat pesanan...</p>
        </div>
      </div>

      <!-- Banner Management Section -->
      <section id="bannerManagementSection" class="mt-12">
        <h3 class="text-2xl md:text-3xl font-bold mb-6 text-center text-[#e94560] flex items-center justify-center space-x-3">
          <i class="fas fa-bullhorn"></i>
          <span>Manajemen Banner Promosi</span>
        </h3>

        <div class="card p-8 rounded-xl mb-8">
          <h4 class="text-xl font-bold mb-4 text-white" id="bannerFormTitle">Unggah Banner Baru</h4>
          <form id="bannerForm" onsubmit="handleBannerSubmit(event)" class="space-y-5">
            <div>
              <label for="bannerTitle" class="block text-sm font-medium mb-2 text-gray-300">Judul Banner</label>
              <input type="text" id="bannerTitle" class="w-full p-3 rounded-lg focus:outline-none" required placeholder="Contoh: Promo Akhir Tahun!">
            </div>
            <div>
              <label for="bannerDescription" class="block text-sm font-medium mb-2 text-gray-300">Deskripsi (Opsional)</label>
              <textarea id="bannerDescription" rows="3" class="w-full p-3 rounded-lg focus:outline-none" placeholder="Deskripsi singkat tentang promosi atau event"></textarea>
            </div>
            <div>
              <label for="bannerLink" class="block text-sm font-medium mb-2 text-gray-300">URL Tautan (Opsional)</label>
              <input type="url" id="bannerLink" class="w-full p-3 rounded-lg focus:outline-none" placeholder="Contoh: https://wa.me/6281234567890">
            </div>
            <div>
              <label for="bannerImage" class="block text-sm font-medium mb-2 text-gray-300">Gambar Banner (Kosongkan jika tidak ingin mengubah)</label>
              <input type="file" id="bannerImage" accept="image/*" class="w-full p-3 rounded-lg focus:outline-none file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-[#e94560] file:text-white hover:file:bg-[#ff6b6b] transition-all duration-200" onchange="previewBannerImage(event)">
              <div id="bannerImagePreview" class="mt-4 flex justify-center"></div>
            </div>
            <div class="flex space-x-4">
                <button type="submit" id="bannerSubmitButton" class="btn-primary w-full text-white px-6 py-3 rounded-lg font-bold text-lg">
                    <i class="fas fa-upload mr-2"></i>Unggah Banner
                </button>
                <button type="button" id="bannerCancelEditButton" onclick="cancelEdit()" class="btn-secondary w-full text-white px-6 py-3 rounded-lg font-bold text-lg hidden">
                    <i class="fas fa-times mr-2"></i>Batal Edit
                </button>
            </div>
          </form>
        </div>

        <div class="card p-8 rounded-xl">
          <h4 class="text-xl font-bold mb-4 text-white">Daftar Banner Aktif</h4>
          <div id="bannerList" class="space-y-4">
            <!-- Banners will be loaded here -->
            <p class="text-gray-400 text-center py-4"><i class="fas fa-spinner fa-spin mr-2"></i>Memuat banner...</p>
          </div>
        </div>
      </section>

    </section>

  </main>

  <!-- Footer -->
  <footer class="text-center p-6 mt-12 text-gray-500 border-t-2 border-[#2e2e4a] bg-[#1a1a2e]">
    <p>Â© 2025 Mizuki Hiroshi Ch. | Admin Dashboard | <a href="https://wa.me/6289634568406" class="text-green-400 underline hover:text-green-300 transition-colors duration-200">Kontak Support</a></p>
  </footer>
</body>
</html>
